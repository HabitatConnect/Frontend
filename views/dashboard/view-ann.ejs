<div class="container-fluid container-fluid-custom pb-5 mb-5">
    <div class="row mb-4">
        <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                    <li class="breadcrumb-item active"><%= announcement.title %></li>
                </ol>
            </nav>

            <div class="col d-flex justify-content-between align-item-center">
                <h1 class="h3">View Announcement</h1>
            </div>
        </div>
    </div>

    <p>Add here who created the announcement

      <p>I hid update/delete buttons if you are viewing an announcement that is not yours
        clean the file since it's messy
        make test inserting announcements and comments on mongodb</p>
      
      <p><%= announcement.user.username %></p>

      You can also access profileImage or change backend as you want to do that
    </p>

    <div class="row justify-content-center">
      
      <% if (isOwner) { %>

        <% if (error) { %>
          <div class="alert alert-danger" role="alert"><%= error %></div>
      <% } %>

        <form action="/dashboard/item/<%= annID %>?_method=PUT" method="POST" class="col-md-10">

            <div class="form-group mb-4">
                <input type="text" class="form-control fw-bold border-0 fs-4" id="title" name="title" value="<%= announcement.title %>" placeholder="Title">
            </div>

            <div class="form-group mb-4">
                <textarea class="form-control pt-5 fs-4" name="body" id="body" rows="10" placeholder="Body"><%= announcement.body %></textarea>
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-primary btn-lg">Update</button>
            </div>

        </form>

        <button type="button" class="btn btn-danger me-2" data-bs-toggle="modal" id="deleteButton" data-bs-target="#deleteModal">
          Delete
        </button>
      <% } else { %>
        <!-- Display announcement details for viewers -->
        <div class="col-md-10">
          <div class="form-group mb-4">
            <input type="text" class="form-control fw-bold border-0 fs-4" id="title" name="title" value="<%= announcement.title %>" readonly>
          </div>
          <div class="form-group mb-4">
            <textarea class="form-control pt-5 fs-4" name="body" id="body" rows="10" readonly><%= announcement.body %></textarea>
          </div>
        </div>
      <% } %>


        <!-- Add a section to display comments -->
        <div class="comments-section">
          <h2>Comments</h2>
          <% if (comments && comments.length > 0) { %>
            <% comments.forEach(comment => { %>
              <div class="comment">
                <p><%= comment.user.username %></p>
                <p><%= comment.text %></p>
            
                <% if (comment.user._id.equals(viewer._id)) { %>
                  <!-- Display the comment text and a text area for updating -->

                  <% if (error) { %>
                    <div class="alert alert-danger" role="alert"><%= error %></div>
                  <% } %>
                

                  <form action="/dashboard/item/<%= annID %>/comment/<%= comment._id %>?_method=PUT" method="POST">
                    <div class="form-group mb-2">
                      <textarea class="form-control" name="updatedText" rows="3" placeholder="Update your comment"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Update Comment</button>
                  </form>
                  <!-- Fix: Change the form tag to a div tag for proper nesting -->
                  <div>
                    <form action="/dashboard/item/<%= annID %>/comment/<%= comment._id %>?_method=DELETE" method="POST">
                      <button type="submit" class="btn btn-danger">Delete Comment</button>
                    </form>
                  </div>
                <% } else { %>
                  <!-- Display the comment text for viewers -->
                  <p><%= comment.text %></p>
                <% } %>
              </div>
            <% }); %>
          <% } else { %>
            <p>No comments</p>
          <% } %>
        </div>

          <!-- Add a button to go to the add-comment page -->
          <a href="/dashboard/item/<%= annID %>/add-comm" class="btn btn-primary">Add Comment</a>
      

    </div>
</div>


<!--modal delete announcement-->
<div class="modal fade" tabindex="-1" id="deleteModal" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <p>Are you sure you want to delete this announcement?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <form action="/dashboard/item-delete/<%= annID %>?_method=DELETE" method="POST" class="position-relative">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit" class="btn btn-primary">Delete</button>
          </form>
        </div>
      </div>
    </div>
</div>